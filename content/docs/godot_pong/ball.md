---
title: 6. М'яч
weight: 6
---

# М'яч

Приступимо до створення м'ячика, який будуть відбивати гравці. 

Почнемо так само, як з дощечками, в тілі вузла `Main` створимо новий вузол типу `Area2D`. Нагадаю, що особливість цього типу об'єктів в тому, що вони можуть виявляти, якщо який-небудь фізичний об'єкт з ними контактує. Якщо відбулась така подія дотику або перетину, цей об'єкт може надіслати сигнал. На сьогодні ми дуже коротко розглянемо сигнали. Просто, що вони існують. Десь на наступних заняттях глянемо в це питання трохи глибше. 

{{< video autoplay="true" muted="true" loop="true" src="BallCreate" >}}

Отже, у нас є новий об'єкт під назвою `Area2D`. Для початку його перейменуємо в `Ball`.

Далі йому треба додати вузол колайдер, щоб об'єкту було відому, яку він має форму. Інакше він не зможе виявляти зіткнення. Натискаємо правою, обираємо додати новий вузол та шукаємо `CollisionShape2D`. 

*Невеличка підказка, якщо ви вже використовували якийсь тип вузлів в проекті, вони будуть доступні зліва, в полі нещодавніх.*

Знак оклику сигналізує для нас, що ми поки не визначили саму форму колайдера. В інспекторі обираємо `Shape` і назначаємо кружечок. Радіус залишаємо 10. 

{{< video autoplay="true" muted="true" loop="true" src="BallCollider" >}}

Поставимо замочок на цей об'єкт, щоб ми його ненароком не перемістили. Далі нам треба якесь зображення для нашої кульки. Але так як у нас поки є тільки одне, це іконка годота, використаємо її. До об'єкту Ball додаємо новий вузол типу Sprite та затягуємо іконку в поле Texture. Як бачите, зображення трохи завелике. Розгортаємо поле Transform та міняємо обидва значення Scale x та y на величину 0.3. Так само, вмикаємо замочок для цього об'єкту, щоб випадково його не перемістити самого по собі.

{{< video autoplay="true" muted="true" loop="true" src="BallSprite" >}}

Тепер виділяємо об'єкт Ball та з допомогою інструменту переміщення, виставляємо його приблизно посередині.

В самому низу інспектора, в полі `Script` обираємо створити новий. В віконці, що з'явилось, залишаємо все як є, та натискаємо `Create`

{{< video autoplay="true" muted="true" loop="true" src="BallScript" >}}

Нам будуть потрібні декілька змінних та констант.
Почнемо з константи, яка зберігатиме для нас початкову швидкість м'ячика. Швидкість ми будемо поступово збільшувати і на старті кожної нової подачі повертати на початкове значення.
Отже, відразу під `extends Area2D` пишемо:
{{< highlight GDScript >}} 
const DEFAULT_SPEED = 200
{{< / highlight >}}
Далі нам потрібний напрямок руху. Напрямок для двовимірної гри зручно зберігати в формі двовимірного вектора. `Godot` надає деякий набір констант векторів. Ми скористаємось такою, щоб задати початковий напрямок.

{{< highlight GDScript >}} 
var direction = Vector2.LEFT
{{< / highlight >}}
Далі нам потрібна змінна для швидкості руху. Ця величина, як я вже сказав, буде змінюватись. Але на початок гри вона повинна дорівнювати значенню, що ми записали в константі. У нас тут є 2 виходи, або оголосити порожню змінну, а величину з константи присвоїти в тілі функції `_ready()`, або скористатись ключовим словом `onready`, яке означає, що значення присвоїться відразу, як вузол додано в сцену.
Отже:

{{< highlight GDScript >}} 
onready var _speed = DEFAULT_SPEED
{{< / highlight >}}
Далі розкоментуємо функцію `_process(delta)` та напишемо:

{{< highlight GDScript >}} 
_speed += delta * 2
position += _speed * delta * direction
{{< / highlight >}}
Тобто, ми поступово збільшуємо швидкість руху на дві величини дельта, яка, нагадую, просто час, який минув з минулого кадру. 
В другому рядку ми до вектора позиції додаємо добуток швидкості знову на дельту та на вектор, що визначає напрямок. Добуток скалярів і вектора дає вектор. Тому в цім рядку ми по суті до вектора позиції додаємо вектор зміщення, який вирахували з швидкості і напрямку. 

Підчищений код зараз мав би виглядати ось так:
{{< highlight GDScript >}} 
extends Area2D

const DEFAULT_SPEED = 200

var direction = Vector2.LEFT

onready var _speed = DEFAULT_SPEED

func _process(delta):
    _speed += delta * 2
    position += _speed * delta * direction
{{< / highlight >}}
І якщо зараз запустити гру, ми побачимо, що наш м'ячик рухається ліворуч. Але зіткнення з дощечкою на нього ніяк не вплинуло. Поки ми ніяк не опрацьовували сигнали зіткнення. Тож, пора це виправити. 
Робити це ми будемо на стороні дощечок. Тому, виділяємо ліву та справа, де у нас інспектор, вгорі шукаємо іншу вкладку, з назвою `Node`. Тут є 2 розділи. Нас цікавить той, що називається `Signals`. Тут є список сигналів, які може надсилати обраний нами вузол. Всі наші активні об'єкти належать до класу `Area2D`, тому нас цікавить сигнал під назвою `area_entered`. Він сигналізуватиме як тільки виявить перетин з об'єктом цього класу. 
Двоклац на потрібному типі сигналу, та обов'язково перейменуємо його на `_on_area_entered`. Це тому, що ми будемо використовувати ту саму функцію для обох дощечок. 

{{< video autoplay="true" muted="true" loop="true" src="AreaSignal" >}}

Для початку перевіримо, чи це точно м'ячик, тому, що пізніше ми додамо стінки, і вони можуть викликати той самий код. Щоб переконатись, ми просто перевіримо ім'я об'єкта, з яким зіткнулись:

{{< highlight GDScript >}} 
if area.name == "Ball":
{{< / highlight >}}
Після того, як ми переконались, можемо змінити напрямок м'ячика. 
Поки спробуємо передати напрямок вправо, просто щоб побачити, що зіткнення опрацьовується вірно.
Отже, додаємо рядок:

{{< highlight GDScript >}} 
    area.direction = Vector2.RIGHT
{{< / highlight >}}
Запустимо гру, і поглянемо на результат. 
Ми повинні побачити, що ліва дощечка зіткнулась з м'ячем, та відправила його вправо. Але з правою ми поки маємо дві проблеми. Ми не з'єднали для неї сигнал, тож вона ніяк не реагує на зіткнення. А також, для неї це не правильний напрямок відбивання. 
Виправимо для початку ситуацію з сигналом. Виділяємо вузол `Right` та на вкладці сигналів двоклац на `area_entered`. Не забуваємо, що ім'я функції має бути таке ж, `_on_area_entered` і уважно дивимось, до кого ми прикріпляємо цей сигнал. Він має бути прикріплений до все цього ж вузла `Right`.

{{< video autoplay="true" muted="true" loop="true" src="AreaSignalRight" >}}

Тепер розбиремось з напрямком. Вгорі створимо нову глобальну змінну `_ball_dir`.
Далі в кінці функції `_ready()` пишемо:

{{< highlight GDScript >}} 
_ball_dir = -1 
if n == "left":
    _ball_dir = 1
{{< / highlight >}}
А далі міняємо рядок зміни напрямку на:
{{< highlight GDScript >}} 
area.direction = Vector2(_ball_dir,0)
{{< / highlight >}}
Якщо зараз запустити гру, м'ячик вже буде відбиватись від обох дощечок. Але гра поки виходить доволі нудна, бо він рухається тільки по одній осі. 
Це ми зараз виправимо, але перш ніж приступити до цієї проблеми, треба вирішити проблему стінок. Їх у нас поки немає, тому, м'ячик легко загубити. 
Отже, далі розглянемо стінки ігрового поля. 
